{% extends 'base.html' %}
{% block content %}

<div class="container mt-4">
  <div class="text-center mb-4">
    <h2 class="fw-bold text-success">ðŸŒ¾ Prediction Results</h2>
    <p class="text-muted">Hereâ€™s your soil analysis summary and smart farm advisory</p>
  </div>

  <!-- âœ… Recommendation Summary -->
  <div class="card shadow-sm p-4 mb-4">
    <h5 class="text-success mb-3">ðŸŒ¿ Recommendation Summary</h5>
    <p><strong>ðŸŒ¾ Recommended Crop:</strong>
      <span class="text-success">{{ session.result_data.crop }}</span>
    </p>
    <p><strong>ðŸŒ± Fertility Level:</strong>
      {% if session.result_data.fertility|lower == 'high' %}
        <span class="badge bg-success">{{ session.result_data.fertility }}</span>
      {% elif session.result_data.fertility|lower == 'medium' %}
        <span class="badge bg-warning text-dark">{{ session.result_data.fertility }}</span>
      {% elif session.result_data.fertility|lower == 'low' %}
        <span class="badge bg-danger">{{ session.result_data.fertility }}</span>
      {% else %}
        <span class="badge bg-primary">{{ session.result_data.fertility }}</span>
      {% endif %}
    </p>
  </div>

  <!-- âœ… Fertility Suggestion -->
  {% if session.result_data.suggestion %}
  <div class="card shadow-sm p-4 mb-4">
    <h5 class="text-success mb-2">ðŸŒ¾ Fertility Suggestion</h5>
    <hr>
    <h6>{{ session.result_data.suggestion.icon }} {{ session.result_data.suggestion.level }}</h6>
    <p>{{ session.result_data.suggestion.message }}</p>
    <p><strong>ðŸ’§ Fertilizer Advice:</strong> {{ session.result_data.suggestion.fertilizer }}</p>
  </div>
  {% endif %}

  <!-- âœ… Farm-Level Summary for CSV uploads -->
  {% if session.result_data.summary %}
  <div class="card shadow-sm p-4 mb-4 border-success">
    <h5 class="text-success mb-2">ðŸŒ¾ Farm-Level Summary</h5>
    <p>{{ session.result_data.summary }}</p>

    {% if session.result_data.sample %}
    <h6 class="mt-3 mb-2 text-secondary">ðŸ“Š Sample Predictions (First 5 Samples)</h6>
    <div class="table-responsive">
      <table class="table table-bordered table-sm align-middle">
        <thead class="table-success">
          <tr>
            {% for col in session.result_data.sample[0].keys() %}
            <th>{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in session.result_data.sample %}
          <tr>
            {% for col, val in row.items() %}
            <td>{{ val }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
  </div>
  {% endif %}

  <!-- âœ… Input Summary -->
  <div class="card shadow-sm p-4 mb-4">
    <h5>ðŸ§® Input Summary</h5>
    {% set labels = session.result_data.input['labels'] %}
    {% set values = session.result_data.input['values'] %}
    <div class="row">
      {% for i in range(labels|length) %}
      <div class="col-6 col-md-4 mb-2">
        <span class="fw-semibold">{{ labels[i] }}:</span> {{ values[i]|round(2) }}
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- âœ… Visualization -->
  <div class="card shadow-sm p-4 text-center mb-4">
    <h5 class="text-primary mb-3">ðŸ“Š Soil Feature Visualization</h5>
    <img src="{{ url_for('static', filename='img/bar.png') }}" class="img-fluid rounded shadow-sm" alt="Bar Chart">
  </div>

  <!-- âœ… Back Button -->
  <div class="text-center">
    <a href="{{ url_for('dashboard') }}" class="btn btn-success mt-3 fw-semibold">â¬… Back to Dashboard</a>
  </div>
</div>

{% endblock %}
